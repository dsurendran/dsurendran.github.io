---
layout: post
title: 'Back Pressure when Server Busy '
date: '2016-08-18T06:59:00.000-07:00'
author: Surendran's blog
tags: 
modified_time: '2016-08-18T07:01:10.223-07:00'
blogger_id: tag:blogger.com,1999:blog-1982846252446038176.post-1717162274418410502
blogger_orig_url: https://surendran-spaces.blogspot.com/2016/08/back-pressure-when-server-busy.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><span style="color: #333333; font-family: &quot;helvetica neue light&quot; , , &quot;helvetica neue&quot; , &quot;helvetica&quot; , &quot;arial&quot; , sans-serif;"><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif; font-size: 14px; line-height: 19.6px;">Applying back pressure to producers(or some one who calls your service) is no more a rocket science. It can be achieved as follows</span></span><br /><span style="color: #333333; font-family: &quot;helvetica neue light&quot; , , &quot;helvetica neue&quot; , &quot;helvetica&quot; , &quot;arial&quot; , sans-serif;"><span style="background-color: white; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif; font-size: 14px; line-height: 19.6px;"><br /></span></span><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;">@Component</span><br /><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">ServerState</span><span style="color: #333333;">{</span><br />   <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">enum</span> State <span style="color: #333333;">{</span><br />      BUSY<span style="color: #333333;">,</span> IDLE<br />   <span style="color: #333333;">}</span><br />   <span style="color: #008800; font-weight: bold;">private</span> State state <span style="color: #333333;">=</span> State<span style="color: #333333;">.</span><span style="color: #0000cc;">IDLE</span><span style="color: #333333;">;</span><br />   <span style="color: #008800; font-weight: bold;">public</span> State <span style="color: #0066bb; font-weight: bold;">getState</span><span style="color: #333333;">()</span> <span style="color: #333333;">{</span><br />      <span style="color: #008800; font-weight: bold;">return</span> state<span style="color: #333333;">;</span><br />   <span style="color: #333333;">}</span><br />   <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #333399; font-weight: bold;">void</span> <span style="color: #0066bb; font-weight: bold;">setState</span><span style="color: #333333;">(</span>State state<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />      <span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">state</span> <span style="color: #333333;">=</span> state<span style="color: #333333;">;</span><br />   <span style="color: #333333;">}</span><br /><span style="color: #333333;">}</span><br /><span style="color: #555555; font-weight: bold;">@Path</span><span style="color: #333333;">(</span><span style="background-color: #fff0f0;">"/api"</span><span style="color: #333333;">)</span><br /><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">MyService</span> <span style="color: #333333;">{</span><br />  <span style="color: #555555; font-weight: bold;">@Inject</span><br />  ServerState state<span style="color: #333333;">;</span><br />  <span style="color: #555555; font-weight: bold;">@POST</span><br />  <span style="color: #008800; font-weight: bold;">public</span> Response <span style="color: #0066bb; font-weight: bold;">method</span><span style="color: #333333;">(</span>String data<span style="color: #333333;">){</span><br />    <span style="color: #008800; font-weight: bold;">if</span><span style="color: #333333;">(</span>state<span style="color: #333333;">.</span><span style="color: #0000cc;">getState</span><span style="color: #333333;">()</span> <span style="color: #333333;">==</span> ServerState<span style="color: #333333;">.</span><span style="color: #0000cc;">State</span><span style="color: #333333;">.</span><span style="color: #0000cc;">BUSY</span><span style="color: #333333;">)</span><br />      <span style="color: #008800; font-weight: bold;">throw</span> <span style="color: #008800; font-weight: bold;">new</span> <span style="color: #0066bb; font-weight: bold;">ServiceUnavailableException</span><span style="color: #333333;">(</span><span style="background-color: #fff0f0;">"Please try after some time"</span><span style="color: #333333;">)</span><br />    <span style="color: #008800; font-weight: bold;">try</span><span style="color: #333333;">{</span><br />      state<span style="color: #333333;">.</span><span style="color: #0000cc;">setState</span><span style="color: #333333;">(</span>ServerState<span style="color: #333333;">.</span><span style="color: #0000cc;">State</span><span style="color: #333333;">.</span><span style="color: #0000cc;">BUSY</span><span style="color: #333333;">);</span><br />      <span style="color: #888888;">//...code....</span><br />    <span style="color: #333333;">}</span><span style="color: #008800; font-weight: bold;">finally</span><span style="color: #333333;">{</span><br />      state<span style="color: #333333;">.</span><span style="color: #0000cc;">setState</span><span style="color: #333333;">(</span>ServerState<span style="color: #333333;">.</span><span style="color: #0000cc;">State</span><span style="color: #333333;">.</span><span style="color: #0000cc;">IDLE</span><span style="color: #333333;">);</span><br />    <span style="color: #333333;">}</span><br />  <span style="color: #333333;">}</span><br /><span style="color: #333333;">}</span><br /></pre></div><br /><span style="color: #333333; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif;"><span style="background-color: white; font-size: 14px; line-height: 19.6px;">Just need to make sure ServerState is always singleton.</span></span><br /><span style="background-color: white; color: #333333; font-family: &quot;arial&quot; , &quot;helvetica&quot; , sans-serif; font-size: 14px; line-height: 19.6px;"><br /></span></div>